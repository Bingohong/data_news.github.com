<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8' />
    <meta name="generator" content="Google Web Designer 1.9.0.0619">
	<meta name="template" content="Interstitial 3.0.0">
	<meta name="environment" content="gwd-doubleclick">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中国非物质文化遗产民俗类地图</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.38.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.38.0/mapbox-gl.css' rel='stylesheet' />
    <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-language/v0.9.0/mapbox-gl-language.js'></script>

    <style>
	  body {
			 margin: 0;
		 padding: 0;
		}

	h2,
	h3 {
	  margin: 10px;
	  font-size: 1.1em;
	}

	h3 {
	  font-size: 1em;
	}

	p {
	  font-size: 0.85em;
	  margin: 10px;
	  text-align: left;
	}

	/**
	* Create a position for the map
	* on the page */
	#map {
	  position: absolute;
	  top: 0;
	  bottom: 0;
	  width: 100%;
	  height:100%;
	}

	/**
	* Set rules for how the map overlays
	* (info box and legend) will be displayed
	* on the page. */
	.map-overlay {
	  position: absolute;
	  bottom: 0;
	  right: 0;
	  background: rgba(255, 255, 255, 0.8);
	  margin-right: 20px;
	  font-family: Arial, sans-serif;
	  overflow: auto;
	  border-radius: 3px;
	}

	#features {
	  top: 0;
	  height: 110px;
	  margin-top: 20px;
	  width: 180px;
	}

	#legend {
	  padding: 10px;
	  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	  line-height: 18px;
	  height: 145px;
	  margin-bottom: 40px;
	  width: 70px;
	}

	.legend-key {
	  display: inline-block;
	  border-radius: 20%;
	  width: 10px;
	  height: 10px;
	  margin-right: 5px;
	}

	.filter-group {
        font: 14px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
        font-weight: 600;
        position: absolute;
        top: 10px;
        left:  50px;
        z-index: 1;
        border-radius: 3px;
        width: 160px;
        color: #fff;
    }

    .filter-group input[type=checkbox]:first-child + label {
        border-radius: 3px 3px 0 0;
    }

    .filter-group label:last-child {
        border-radius: 0 0 3px 3px;
        border: none;
    }

    .filter-group input[type=checkbox] {
        display: none;
    }

    .filter-group input[type=checkbox] + label {
        background-color: #3386c0;
        display: block;
        cursor: pointer;
        padding: 10px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.25);
    }

    .filter-group input[type=checkbox] + label {
        background-color: #3386c0;
        text-transform: capitalize;
    }

    .filter-group input[type=checkbox] + label:hover,
    .filter-group input[type=checkbox]:checked + label {
        background-color: #4ea0da;
    }

    .filter-group input[type=checkbox]:checked + label:before {
        content: '✔';
        margin-right: 5px;
    }
    </style>
  </head>


  <body>
    <div id='map'></div>
    <div class='map-overlay' id='features'><h2>非遗民俗类424项：</h2><div id='pd'><p>移动到各地区！</p></div></div>
	<div class='map-overlay' id='legend'></div>
	<nav id='filter-group' class='filter-group'></nav>


    <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiYmluZ29ob25nIiwiYSI6ImNqNWtoemwxdzJ1OWYzM25xNDduZ3M0ZmgifQ.Zx111INft74MEenLA6CNSw'; // replace this with your access token
	//初始化地图
    var filterGroup = document.getElementById('filter-group');
    var map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/bingohong/cj5nafv0646u72slflqqvh649' // replace this with your style URL
    });

  //语言本地化
    var language = new MapboxLanguage();
    map.addControl(language);

    // code from the next step will go here
    map.on('load', function() {
  // 添加图例信息
	var layers = ['0-5', '5-10', '10-15', '15-20', "20-25",'25-30', '30-35', '35-40'];
	var colors = ['#FFEDA0', '#FED976', '#FEB24C', '#FD8D3C', '#FC4E2A', '#E31A1C', '#BD0026', '#800026',"#940521"];
	for (i = 0; i < layers.length; i++) {
	  var layer = layers[i];
	  var color = colors[i];
	  var item = document.createElement('div');
	  var key = document.createElement('span');
	  key.className = 'legend-key';
	  key.style.backgroundColor = color;

	  var value = document.createElement('span');
	  value.innerHTML = layer;
	  item.appendChild(key);
	  item.appendChild(value);
	  legend.appendChild(item);
      }
	});

	map.on('mousemove', function(e) {
	//添加信息窗信息
	  var states = map.queryRenderedFeatures(e.point, {
	    layers: ['china']
	  });

	  if (states.length > 0) {
	    document.getElementById('pd').innerHTML = '<h3><strong>' + states[0].properties.name + '</strong></h3><p><em>民俗类非遗 </em><strong><em>'+states[0].properties.items_total + '</strong> 项</em></p>';
	  } else {
	    document.getElementById('pd').innerHTML = '<p>移动到各地区！</p>';
	  }
	});

    map.on('click', function(e) {
    	//添加点击事件
		  var features = map.queryRenderedFeatures(e.point, {
		    layers: ['true-2006',"true-2008","true-2011","true-2014"] // replace this with the name of the layer
		  });

		  if (!features.length) {
		    return;
		  }

		  var feature = features[0];

		  var popup = new mapboxgl.Popup({ offset: [0, -15] })
		    .setLngLat(feature.geometry.coordinates)
		    .setHTML('<h3>' + feature.properties.province + '</h3><p>' + feature.properties.items + '</p>')
		    .setLngLat(feature.geometry.coordinates)
		    .addTo(map);
		});

    map.on('load', function() {
    	//添加筛选框事件
		  var layerID=['true-2006',"true-2008","true-2011","true-2014"]
		  var timename=["2006年申报-121项","2008年申报-134项","2011年申报-89项","2014年申报-80项"]
		

		  for (i = 0; i < layerID.length; i++) {
			  var layer=layerID[i]
			  var input = document.createElement('input');
	            input.type = 'checkbox';
	            input.id = layer;
	            input.checked = true;
	            filterGroup.appendChild(input);

	          var time=timename[i]
	          var label = document.createElement('label');
	            label.setAttribute('for', layer);
	            label.textContent = time;
	            filterGroup.appendChild(label);

	            // When the checkbox changes, update the visibility of the layer.
	            input.addEventListener('change', (function(){
	            	var layer_target=layer
	            	return function(e) {	            	
		                map.setLayoutProperty(layer_target, 'visibility',
		                    e.target.checked ? 'visible' : 'none')
			            };
	            })());
		      }
		});
	//添加导航控件
    var nav = new mapboxgl.NavigationControl();
	map.addControl(nav, 'top-left');

	//比例尺显示控件
	map.addControl(new mapboxgl.ScaleControl({
	    maxWidth: 200,
	    unit: 'metric'
	}));

    map.getCanvas().style.cursor = 'default';

    
    </script>
  </body>
</html>
